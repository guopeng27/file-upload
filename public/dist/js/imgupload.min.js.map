{"version":3,"sources":["imgupload.es"],"names":["$","ImgUpload","element","options","_classCallCheck","this","setOptions","_createClass","key","value","upButton","url","autoUpload","dropArea","filesList","maxSize","maxLength","beginUp","filter","files","prevImg","progress","compeleted","init","fileAdded","e","self","stopPropagation","preventDefault","removeClass","target","originalEvent","dataTransfer","filterFiles","concat","prevFilesSrc","each","index","file","reader","FileReader","readAsDataURL","onload","push","result","length","upload","alert","formData","FormData","item","append","ajax","xhr","window","XMLHttpRequest","addEventListener","type","data","processData","contentType","success","msg","dragEnter","addClass","dragLeave","on","proxy","document","dragleave","drop","dragenter","dragover","fn","imgupload","cb","el","remove"],"mappings":"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","file":"imgupload.min.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/25.\r\n */\r\n\r\n\r\n!function($){\r\n    class ImgUpload{\r\n        constructor(element,options){\r\n            this.element = element;\r\n            this.setOptions(options)\r\n        }\r\n        setOptions(options){\r\n            this.upButton = $(options.upButton);\r\n            this.url = options.url;\r\n            this.autoUpload  = false || options.autoUpload;\r\n            this.dropArea = null || $(options.dropArea);\r\n            this.filesList = [];\r\n            this.maxSize = options.maxSize || (2 * 1024 * 1024);\r\n            this.maxLength = options.maxLength || 10;\r\n\r\n            this.beginUp = options.beginUp || function(){};\r\n            this.filter = options.filter || function(files){ return files;};\r\n            this.prevImg = options.prevImg || function(){};\r\n            this.progress = options.progress || function(){};\r\n            this.compeleted = options.compeleted || function(){};\r\n\r\n\r\n\r\n            this.init();\r\n        }\r\n\r\n        fileAdded (e){\r\n            let self = this;\r\n            e.stopPropagation()\r\n            e.preventDefault();\r\n            this.dropArea.removeClass('active');\r\n            let files = e.target.files || e.originalEvent.dataTransfer.files;\r\n            //当前新增过滤后文件\r\n            let filterFiles = self.filter(files);\r\n            //上传队列\r\n            self.filesList = self.filesList.concat(filterFiles);\r\n            //当前新增预览\r\n            let prevFilesSrc = [];\r\n            $(filterFiles).each(function(index,file){\r\n                //预览图队列\r\n                let reader = new FileReader();\r\n                reader.readAsDataURL(file);\r\n                reader.onload = function (e) {\r\n                    prevFilesSrc.push(e.target.result);\r\n                    if(index == filterFiles.length -1) {\r\n                        self.prevImg(prevFilesSrc);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        upload(){\r\n            if(this.filesList.length == 0){\r\n                alert('请先选择需要上传的文件！');\r\n                return\r\n            }\r\n            let self = this;\r\n            let formData = new FormData();\r\n            $(this.filesList).each(function(index,item){\r\n                formData.append('file'+index,item)\r\n            });\r\n            self.beginUp();\r\n            $.ajax({\r\n                xhr: function(){\r\n                    var xhr = new window.XMLHttpRequest();\r\n                    xhr.upload.addEventListener(\"progress\" , function(e){\r\n                        self.progress(e);\r\n                    }, false);\r\n                    return xhr;\r\n                },\r\n                url : this.url,\r\n                type : 'POST',\r\n                data : formData,\r\n                processData: false,\r\n                contentType: false,\r\n                success : function(msg){\r\n                    self.filesList.length = 0;\r\n                    self.compeleted(msg);\r\n                }\r\n            });\r\n        }\r\n\r\n        dragEnter(){\r\n            this.dropArea.addClass('active');\r\n        }\r\n\r\n        dragLeave(){\r\n            this.dropArea.removeClass('active');\r\n        }\r\n\r\n        init(){\r\n            //初始化事件\r\n\r\n            //fileInput\r\n            this.element.on('change',$.proxy(this.fileAdded,this));\r\n\r\n            //上传\r\n            if(this.upButton && this.autoUpload == false){\r\n                this.upButton.on('click',$.proxy(this.upload,this));\r\n            }\r\n\r\n            //拖拽\r\n            if (this.dropArea) {\r\n                this.dropArea.on(\"dragenter\", $.proxy(this.dragEnter,this));\r\n                this.dropArea.on(\"dragleave\", $.proxy(this.dragLeave,this));\r\n                this.dropArea.on(\"drop\", $.proxy(this.fileAdded,this));\r\n            }\r\n\r\n            //阻止浏览器默认行。\r\n            $(document).on({\r\n                dragleave:function(e){e.preventDefault();},\r\n                drop:function(e){ e.preventDefault();},\r\n                dragenter:function(e){ e.preventDefault();},\r\n                dragover:function(e){e.preventDefault();}\r\n            });\r\n        }\r\n    }\r\n\r\n    $.fn.imgupload = function(options,cb) {\r\n        this.each(function(){\r\n            var el = $(this);\r\n            if(el.data('imgupload')){\r\n                el.data('imgupload').remove()\r\n            }\r\n            el.data('imgupload', new ImgUpload(el, options, cb));\r\n        })\r\n        return this\r\n    }\r\n}($);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}