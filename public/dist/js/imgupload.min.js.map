{"version":3,"sources":["imgupload.es"],"names":["$","ImgUpload","element","options","_classCallCheck","this","setOptions","_createClass","key","value","upButton","prevImg","url","autoUpload","dragDrop","filesFilter","filter","progress","compeleted","init","fileAdded","e","self","stopPropagation","preventDefault","files","target","originalEvent","dataTransfer","prevFilesSrc","each","index","file","push","reader","FileReader","readAsDataURL","onload","result","upload","ajax","xhr","window","XMLHttpRequest","addEventListener","type","data","formData","processData","contentType","success","on","proxy","fn","imgupload","cb","el","remove","document","dragleave","drop","dragenter","dragover","imgs","console","log","evt","lengthComputable","timer","percentComplete","loaded","total","show","animate","width","fadeOut","clearInterval","html","setInterval","parseInt","Math","floor","msg"],"mappings":"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","file":"imgupload.min.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/25.\r\n */\r\n\r\n\r\n!function($){\r\n    class ImgUpload{\r\n        constructor(element,options){\r\n            this.element = element;\r\n            this.setOptions(options)\r\n        }\r\n        setOptions(options){\r\n            this.upButton = $(options.upButton);\r\n            this.prevImg = options.prevImg;\r\n            this.url = options.url;\r\n            this.autoUpload  = false || options.autoUpload;\r\n            this.dragDrop = null || $(options.dragDrop);\r\n            this.filesFilter = [];\r\n\r\n            this.filter = options.filter || function(){};\r\n            this.prevImg = options.prevImg || function(){};\r\n            this.progress = options.progress || function(){};\r\n            this.compeleted = options.compeleted || function(){};\r\n\r\n\r\n            this.init();\r\n        }\r\n\r\n        fileAdded (e){\r\n            let self = this;\r\n            e.stopPropagation()\r\n            e.preventDefault();\r\n            let files = e.target.files || e.originalEvent.dataTransfer.files;\r\n            let prevFilesSrc = [];\r\n            $(files).each(function(index,file){\r\n                //上传文件添加至队列\r\n                self.filesFilter.push(file);\r\n                //预览图队列\r\n                let reader = new FileReader();\r\n                reader.readAsDataURL(file);\r\n                reader.onload = function (e) {\r\n                    prevFilesSrc.push(e.target.result);\r\n                }\r\n            });\r\n            this.prevImg(prevFilesSrc);\r\n        }\r\n\r\n        upload(){\r\n            $.ajax({\r\n                xhr: function(){\r\n                    var xhr = new window.XMLHttpRequest();\r\n                    xhr.upload.addEventListener(\"progress\" , function(e){\r\n                        this.progress(e);\r\n                    }, false);\r\n                    return xhr;\r\n                },\r\n                url : this.url,\r\n                type : 'POST',\r\n                data : formData,\r\n                processData: false,\r\n                contentType: false,\r\n                success : this.compeleted\r\n            });\r\n        }\r\n\r\n        init(){\r\n            //初始化事件\r\n\r\n            //fileInput\r\n            this.element.on('change',$.proxy(this.fileAdded,this));\r\n\r\n            //上传\r\n            if(this.upButton && this.autoUpload == false){\r\n                this.upButton.on('click',$.proxy(this.upload,this));\r\n            }\r\n\r\n            //拖拽\r\n            if (this.dragDrop) {\r\n                this.dragDrop.on(\"drop\", $.proxy(this.fileAdded,this));\r\n            }\r\n        }\r\n    }\r\n\r\n    $.fn.imgupload = function(options,cb) {\r\n        this.each(function(){\r\n            var el = $(this);\r\n            if(el.data('imgupload')){\r\n                el.data('imgupload').remove()\r\n            }\r\n            el.data('imgupload', new ImgUpload(el, options, cb));\r\n        })\r\n        return this\r\n    }\r\n}($);\r\n\r\n\r\n\r\n\r\n\r\n\r\n$(function(){\r\n    //阻止浏览器默认行。\r\n    $(document).on({\r\n        dragleave:function(e){    //拖离\r\n            e.preventDefault();\r\n        },\r\n        drop:function(e){  //拖后放\r\n            e.preventDefault();\r\n        },\r\n        dragenter:function(e){    //拖进\r\n            e.preventDefault();\r\n        },\r\n        dragover:function(e){    //拖来拖去\r\n            e.preventDefault();\r\n        }\r\n    });\r\n});\r\n$('#upBtn').imgupload({\r\n    upButton : '#up', //上传按钮\r\n    url : '/upload', //post地址\r\n    dragDrop : '#drop', //拖拽敏感区域\r\n    autoUpload : false, //是否自动上传\r\n    prevImg : function(imgs){ //预览图片\r\n        console.log(imgs)\r\n    },\r\n    filter : function(files){ //过滤文件\r\n\r\n    },\r\n    progress : function(evt){ //上传进度\r\n        if (evt.lengthComputable) {\r\n            var timer;\r\n            var percentComplete = evt.loaded / evt.total;\r\n            $('#progressBar').show();\r\n            $('#progressBar .inner').animate({width:percentComplete*100+'%'},function(){\r\n                if(percentComplete == 1 ){\r\n                    $('#progressBar').fadeOut();\r\n                    clearInterval(timer)\r\n                    $('#progressBar .num').html(percentComplete*100+'%');\r\n                }\r\n            });\r\n            timer = setInterval(function(){\r\n                if(parseInt($('#progressBar .num').html()) == Math.floor(percentComplete*100)){\r\n                    clearInterval(timer)\r\n                }else{\r\n                    $('#progressBar .num').html(parseInt($('#progressBar .num').html())+1+'%');\r\n                }\r\n            },60)\r\n\r\n        }\r\n    },\r\n    compeleted : function(msg){ //上完完毕\r\n        console.log(msg)\r\n    }\r\n});\r\n\r\n"]}