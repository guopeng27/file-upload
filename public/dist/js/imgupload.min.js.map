{"version":3,"sources":["imgupload.es"],"names":["$","ImgUpload","element","options","_classCallCheck","this","setOptions","_createClass","key","value","upButton","url","autoUpload","dropArea","filesFilter","filter","prevImg","progress","compeleted","init","fileAdded","e","self","stopPropagation","preventDefault","removeClass","files","target","originalEvent","dataTransfer","prevFilesSrc","each","index","file","push","reader","FileReader","readAsDataURL","onload","result","length","upload","alert","formData","FormData","item","append","ajax","xhr","window","XMLHttpRequest","addEventListener","type","data","processData","contentType","success","msg","dragEnter","addClass","dragLeave","on","proxy","document","dragleave","drop","dragenter","dragover","fn","imgupload","cb","el","remove","imgs","_imgs","evt","lengthComputable","percentComplete","loaded","total","next","html","Math","floor","after","code","setTimeout","fadeOut"],"mappings":"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","file":"imgupload.min.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/25.\r\n */\r\n\r\n\r\n!function($){\r\n    class ImgUpload{\r\n        constructor(element,options){\r\n            this.element = element;\r\n            this.setOptions(options)\r\n        }\r\n        setOptions(options){\r\n            this.upButton = $(options.upButton);\r\n            this.url = options.url;\r\n            this.autoUpload  = false || options.autoUpload;\r\n            this.dropArea = null || $(options.dropArea);\r\n            this.filesFilter = [];\r\n\r\n            this.filter = options.filter || function(){};\r\n            this.prevImg = options.prevImg || function(){};\r\n            this.progress = options.progress || function(){};\r\n            this.compeleted = options.compeleted || function(){};\r\n\r\n\r\n            this.init();\r\n        }\r\n\r\n        fileAdded (e){\r\n            let self = this;\r\n            e.stopPropagation()\r\n            e.preventDefault();\r\n            this.dropArea.removeClass('active');\r\n            let files = e.target.files || e.originalEvent.dataTransfer.files;\r\n            let prevFilesSrc = [];\r\n            $(files).each(function(index,file){\r\n                //上传文件添加至队列\r\n                self.filesFilter.push(file);\r\n                //预览图队列\r\n                let reader = new FileReader();\r\n                reader.readAsDataURL(file);\r\n                reader.onload = function (e) {\r\n                    prevFilesSrc.push(e.target.result);\r\n                    if(index == $(files).length -1 ){\r\n                        //预览回调\r\n                        self.prevImg(prevFilesSrc);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        upload(){\r\n            if(this.filesFilter.length == 0){\r\n                alert('请先选择需要上传的文件！');\r\n                return\r\n            }\r\n            let self = this;\r\n            let formData = new FormData();\r\n            $(this.filesFilter).each(function(index,item){\r\n                formData.append('file'+index,item)\r\n            });\r\n            $.ajax({\r\n                xhr: function(){\r\n                    var xhr = new window.XMLHttpRequest();\r\n                    xhr.upload.addEventListener(\"progress\" , function(e){\r\n                        self.progress(e);\r\n                    }, false);\r\n                    return xhr;\r\n                },\r\n                url : this.url,\r\n                type : 'POST',\r\n                data : formData,\r\n                processData: false,\r\n                contentType: false,\r\n                success : function(msg){\r\n                    self.filesFilter.length = 0;\r\n                    self.compeleted(msg);\r\n                }\r\n            });\r\n        }\r\n\r\n        dragEnter(){\r\n            this.dropArea.addClass('active');\r\n        }\r\n\r\n        dragLeave(){\r\n            this.dropArea.removeClass('active');\r\n        }\r\n\r\n        init(){\r\n            //初始化事件\r\n\r\n            //fileInput\r\n            this.element.on('change',$.proxy(this.fileAdded,this));\r\n\r\n            //上传\r\n            if(this.upButton && this.autoUpload == false){\r\n                this.upButton.on('click',$.proxy(this.upload,this));\r\n            }\r\n\r\n            //拖拽\r\n            if (this.dropArea) {\r\n                this.dropArea.on(\"dragenter\", $.proxy(this.dragEnter,this));\r\n                this.dropArea.on(\"dragleave\", $.proxy(this.dragLeave,this));\r\n                this.dropArea.on(\"drop\", $.proxy(this.fileAdded,this));\r\n            }\r\n\r\n            //阻止浏览器默认行。\r\n            $(document).on({\r\n                dragleave:function(e){e.preventDefault();},\r\n                drop:function(e){ e.preventDefault();},\r\n                dragenter:function(e){ e.preventDefault();},\r\n                dragover:function(e){e.preventDefault();}\r\n            });\r\n        }\r\n    }\r\n\r\n    $.fn.imgupload = function(options,cb) {\r\n        this.each(function(){\r\n            var el = $(this);\r\n            if(el.data('imgupload')){\r\n                el.data('imgupload').remove()\r\n            }\r\n            el.data('imgupload', new ImgUpload(el, options, cb));\r\n        })\r\n        return this\r\n    }\r\n}($);\r\n\r\n\r\n\r\n$('#upBtn').imgupload({\r\n    upButton : '#up', //上传按钮\r\n    dropArea : '#drop', //拖拽敏感区域\r\n    url : '/upload', //post地址\r\n    autoUpload : false, //是否自动上传\r\n    prevImg : function(imgs){ //预览图片\r\n        var _imgs = '';\r\n        $(imgs).each(function(index,item){\r\n            _imgs += '<img width=\"100\" height=\"100\" src=\"'+ item +'\">';\r\n        });\r\n        $('#prev').append(_imgs);\r\n\r\n    },\r\n    filter : function(files){ //过滤文件\r\n\r\n    },\r\n    progress : function(evt){ //上传进度\r\n        if (evt.lengthComputable) {\r\n            var percentComplete = evt.loaded / evt.total;\r\n            if($('#up').next('.num').length){\r\n                $('#up').next('.num').html(Math.floor(percentComplete*100)+'%');\r\n            }else{\r\n                $('#up').after('<span class=\"num\">'+ Math.floor(percentComplete*100) + '%</span>');\r\n            }\r\n        }\r\n    },\r\n    compeleted : function(msg){ //上完完毕\r\n        if(msg.code == 'ok'){\r\n            $('#prev').html('');\r\n            $('#up').next('.num').html('上传完毕！');\r\n            setTimeout(function(){\r\n                $('#up').next('.num').fadeOut(300);\r\n            },1000);\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n"]}