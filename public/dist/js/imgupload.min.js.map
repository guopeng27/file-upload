{"version":3,"sources":["imgupload.es"],"names":["$","ImgUpload","element","options","_classCallCheck","this","setOptions","_createClass","key","value","upButton","url","autoUpload","dropArea","filesList","maxSize","maxLength","filter","files","prevImg","progress","compeleted","init","fileAdded","e","self","stopPropagation","preventDefault","removeClass","target","originalEvent","dataTransfer","filterFiles","concat","prevFilesSrc","each","index","file","reader","FileReader","readAsDataURL","onload","push","result","length","upload","alert","formData","FormData","item","append","ajax","xhr","window","XMLHttpRequest","addEventListener","type","data","processData","contentType","success","msg","dragEnter","addClass","dragLeave","on","proxy","document","dragleave","drop","dragenter","dragover","fn","imgupload","cb","el","remove","imgs","_imgs","filterArr","overWarning","size","name","evt","lengthComputable","percentComplete","loaded","total","next","html","Math","floor","after","code","setTimeout","fadeOut"],"mappings":"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","file":"imgupload.min.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/25.\r\n */\r\n\r\n\r\n!function($){\r\n    class ImgUpload{\r\n        constructor(element,options){\r\n            this.element = element;\r\n            this.setOptions(options)\r\n        }\r\n        setOptions(options){\r\n            this.upButton = $(options.upButton);\r\n            this.url = options.url;\r\n            this.autoUpload  = false || options.autoUpload;\r\n            this.dropArea = null || $(options.dropArea);\r\n            this.filesList = [];\r\n            this.maxSize = options.maxSize || (2 * 1024 * 1024);\r\n            this.maxLength = options.maxLength || 10;\r\n\r\n            this.filter = options.filter || function(files){ return files;};\r\n            this.prevImg = options.prevImg || function(){};\r\n            this.progress = options.progress || function(){};\r\n            this.compeleted = options.compeleted || function(){};\r\n\r\n\r\n            this.init();\r\n        }\r\n\r\n        fileAdded (e){\r\n            let self = this;\r\n            e.stopPropagation()\r\n            e.preventDefault();\r\n            this.dropArea.removeClass('active');\r\n            let files = e.target.files || e.originalEvent.dataTransfer.files;\r\n            //当前新增过滤后文件\r\n            let filterFiles = self.filter(files);\r\n            //上传队列\r\n            self.filesList = self.filesList.concat(filterFiles);\r\n            //当前新增预览\r\n            let prevFilesSrc = [];\r\n            $(filterFiles).each(function(index,file){\r\n                //预览图队列\r\n                let reader = new FileReader();\r\n                reader.readAsDataURL(file);\r\n                reader.onload = function (e) {\r\n                    prevFilesSrc.push(e.target.result);\r\n                    if(index == filterFiles.length -1) {\r\n                        self.prevImg(prevFilesSrc);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        upload(){\r\n            if(this.filesList.length == 0){\r\n                alert('请先选择需要上传的文件！');\r\n                return\r\n            }\r\n            let self = this;\r\n            let formData = new FormData();\r\n            $(this.filesList).each(function(index,item){\r\n                formData.append('file'+index,item)\r\n            });\r\n            $.ajax({\r\n                xhr: function(){\r\n                    var xhr = new window.XMLHttpRequest();\r\n                    xhr.upload.addEventListener(\"progress\" , function(e){\r\n                        self.progress(e);\r\n                    }, false);\r\n                    return xhr;\r\n                },\r\n                url : this.url,\r\n                type : 'POST',\r\n                data : formData,\r\n                processData: false,\r\n                contentType: false,\r\n                success : function(msg){\r\n                    self.filesList.length = 0;\r\n                    self.compeleted(msg);\r\n                }\r\n            });\r\n        }\r\n\r\n        dragEnter(){\r\n            this.dropArea.addClass('active');\r\n        }\r\n\r\n        dragLeave(){\r\n            this.dropArea.removeClass('active');\r\n        }\r\n\r\n        init(){\r\n            //初始化事件\r\n\r\n            //fileInput\r\n            this.element.on('change',$.proxy(this.fileAdded,this));\r\n\r\n            //上传\r\n            if(this.upButton && this.autoUpload == false){\r\n                this.upButton.on('click',$.proxy(this.upload,this));\r\n            }\r\n\r\n            //拖拽\r\n            if (this.dropArea) {\r\n                this.dropArea.on(\"dragenter\", $.proxy(this.dragEnter,this));\r\n                this.dropArea.on(\"dragleave\", $.proxy(this.dragLeave,this));\r\n                this.dropArea.on(\"drop\", $.proxy(this.fileAdded,this));\r\n            }\r\n\r\n            //阻止浏览器默认行。\r\n            $(document).on({\r\n                dragleave:function(e){e.preventDefault();},\r\n                drop:function(e){ e.preventDefault();},\r\n                dragenter:function(e){ e.preventDefault();},\r\n                dragover:function(e){e.preventDefault();}\r\n            });\r\n        }\r\n    }\r\n\r\n    $.fn.imgupload = function(options,cb) {\r\n        this.each(function(){\r\n            var el = $(this);\r\n            if(el.data('imgupload')){\r\n                el.data('imgupload').remove()\r\n            }\r\n            el.data('imgupload', new ImgUpload(el, options, cb));\r\n        })\r\n        return this\r\n    }\r\n}($);\r\n\r\n\r\n\r\n$('#upBtn').imgupload({\r\n    upButton : '#up', //上传按钮\r\n    dropArea : '#drop', //拖拽敏感区域\r\n    url : '/upload', //post地址\r\n    autoUpload : false, //是否自动上传\r\n    prevImg : function(imgs){ //预览图片\r\n        var _imgs = '';\r\n        $(imgs).each(function(index,item){\r\n\r\n            _imgs += '<img width=\"100\" height=\"100\" src=\"'+ item +'\">';\r\n        });\r\n        $('#prev').append(_imgs);\r\n\r\n    },\r\n    filter : function(files){ //过滤文件\r\n        var filterArr = [];\r\n        var overWarning = '';\r\n        $(files).each(function(index,item){\r\n            if(item.size > 2*1024*1024){\r\n                overWarning += item.name + ':体积大于2M,请压缩后上传!\\n';\r\n            }else{\r\n                filterArr.push(item)\r\n            }\r\n        });\r\n        if(overWarning){ alert(overWarning);}\r\n        return filterArr;\r\n    },\r\n    progress : function(evt){ //上传进度\r\n        if (evt.lengthComputable) {\r\n            var percentComplete = evt.loaded / evt.total;\r\n            if($('#up').next('.num').length){\r\n                $('#up').next('.num').html(Math.floor(percentComplete*100)+'%');\r\n            }else{\r\n                $('#up').after('<span class=\"num\">'+ Math.floor(percentComplete*100) + '%</span>');\r\n            }\r\n        }\r\n    },\r\n    compeleted : function(msg){ //上完完毕\r\n        if(msg.code == 'ok'){\r\n            $('#prev').html('');\r\n            $('#up').next('.num').html('上传完毕！');\r\n            setTimeout(function(){\r\n                $('#up').next('.num').fadeOut(300,function () {\r\n                    $('#up').next('.num').remove();\r\n                });\r\n            },1000);\r\n        }\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n"]}