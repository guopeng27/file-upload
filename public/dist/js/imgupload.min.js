"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,n,a){if(n)e(t.prototype,n);if(a)e(t,a);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}!function(e){var t=function(){function t(e,n){_classCallCheck(this,t);this.element=e;this.setOptions(n)}_createClass(t,[{key:"setOptions",value:function t(n){this.upButton=e(n.upButton);this.url=n.url;this.autoUpload=false||n.autoUpload;this.dropArea=null||e(n.dropArea);this.filesFilter=[];this.maxSize=n.maxSize||2*1024*1024;this.maxLength=n.maxLength||10;this.filter=n.filter||function(e){return e};this.prevImg=n.prevImg||function(){};this.progress=n.progress||function(){};this.compeleted=n.compeleted||function(){};this.init()}},{key:"fileAdded",value:function t(n){var a=this;n.stopPropagation();n.preventDefault();this.dropArea.removeClass("active");var r=a.filter(n.target.files)||a.filter(n.originalEvent.dataTransfer.files);a.filesFilter.concat(r);var i=r.length;var o=[];e(r).each(function(e,t){var n=new FileReader;n.readAsDataURL(t);n.onload=function(t){o.push(t.target.result);if(e==r.length-1){a.prevImg(o)}}})}},{key:"upload",value:function t(){if(this.filesFilter.length==0){alert("请先选择需要上传的文件！");return}var n=this;var a=new FormData;e(this.filesFilter).each(function(e,t){a.append("file"+e,t)});e.ajax({xhr:function e(){var e=new window.XMLHttpRequest;e.upload.addEventListener("progress",function(e){n.progress(e)},false);return e},url:this.url,type:"POST",data:a,processData:false,contentType:false,success:function e(t){n.filesFilter.length=0;n.compeleted(t)}})}},{key:"dragEnter",value:function e(){this.dropArea.addClass("active")}},{key:"dragLeave",value:function e(){this.dropArea.removeClass("active")}},{key:"init",value:function t(){this.element.on("change",e.proxy(this.fileAdded,this));if(this.upButton&&this.autoUpload==false){this.upButton.on("click",e.proxy(this.upload,this))}if(this.dropArea){this.dropArea.on("dragenter",e.proxy(this.dragEnter,this));this.dropArea.on("dragleave",e.proxy(this.dragLeave,this));this.dropArea.on("drop",e.proxy(this.fileAdded,this))}e(document).on({dragleave:function e(t){t.preventDefault()},drop:function e(t){t.preventDefault()},dragenter:function e(t){t.preventDefault()},dragover:function e(t){t.preventDefault()}})}}]);return t}();e.fn.imgupload=function(n,a){this.each(function(){var r=e(this);if(r.data("imgupload")){r.data("imgupload").remove()}r.data("imgupload",new t(r,n,a))});return this}}($);$("#upBtn").imgupload({upButton:"#up",dropArea:"#drop",url:"/upload",autoUpload:false,prevImg:function e(t){var n="";$(t).each(function(e,t){n+='<img width="100" height="100" src="'+t+'">'});$("#prev").append(n)},filter:function e(t){var n=[];var a="";$(t).each(function(e,t){if(t.size>2*1024*1024){a+=t.name+":体积大于2M,请压缩后上传!\n"}else{n.push(t)}});alert(a);return n},progress:function e(t){if(t.lengthComputable){var n=t.loaded/t.total;if($("#up").next(".num").length){$("#up").next(".num").html(Math.floor(n*100)+"%")}else{$("#up").after('<span class="num">'+Math.floor(n*100)+"%</span>")}}},compeleted:function e(t){if(t.code=="ok"){$("#prev").html("");$("#up").next(".num").html("上传完毕！");setTimeout(function(){$("#up").next(".num").fadeOut(300,function(){$("#up").remove()})},1e3)}}});
//# sourceMappingURL=imgupload.min.js.map
